<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Caesar & VigenÃ¨re Escape Room</title>
  <link rel="stylesheet" href="styles.css"/>
  <script>
    // Dialog polyfill
    if (!('showModal' in document.createElement('dialog'))) {
      const dialogs = document.getElementsByTagName('dialog');
      Array.from(dialogs).forEach(dialog => {
        if (!dialog.showModal) {
          dialog.showModal = function() {
            this.setAttribute('open', '');
            this.style.display = 'block';
          };
          dialog.close = function() {
            this.removeAttribute('open');
            this.style.display = 'none';
          };
        }
      });
    }
  </script>
</head>
<body>
  <main id="app" class="container">
    <!-- Intro / Start Screen -->
    <section id="screen-intro" class="screen active" role="region" aria-labelledby="intro-title">
      <h1 id="intro-title">Crypto Escape Room</h1>
      <p class="lede">
        ğŸ±ğŸ¶ğŸ• Youâ€™re relaxing at home after a long day at school. Your <strong>tabby</strong> cat <strong>Cipher</strong> prowls your room, a great <strong>nerdcore</strong> song loops in your head,
        and in the kitchen the aroma cooking <strong>French pastries</strong> tells you that dinner will be amazing, with <strong>BBQ chicken pizza</strong>, great <strong>cheeses</strong> and <strong>prosciutto</strong> with fresh <strong>baguette</strong>, all to be followed by <strong>cake</strong>. 
        But what if something gets in the way of this amazing meal?
        Decode the messages (Caesar + VigenÃ¨re) to unlock each â€œdoorâ€ before time runs out.
      </p>
      <ul class="rules">
        <li>Start with <strong>Caesar</strong> (fixed shift), unlock <strong>VigenÃ¨re</strong> (keywordâ€‘based) bonuses.</li>
        <li>Use <strong>Tools</strong> (brute force, frequency, VigenÃ¨re helper) and the <strong>Tutorial</strong> if stuck.</li>
        <li>Hints cost points. Faster solves = higher score. Save your score to the <strong>leaderboard</strong>.</li>
      </ul>
      <div class="intro-actions">
        <button id="btn-start" class="btn primary">Start</button>
        <button id="btn-leaderboard" class="btn">ğŸ† Leaderboard</button>
        <button id="btn-tutorial-intro" class="btn">ğŸ“˜ Tutorial</button>
        <button id="btn-dyslexia" class="btn" aria-pressed="false" aria-label="Toggle dyslexia-friendly mode">Aa Accessibility</button>
      </div>
    </section>

    <!-- Game Screen -->

    <section id="screen-game" class="screen" role="region" aria-live="polite">
      <header class="hud">
        <div>â­ Score: <span id="hud-score">0</span></div>
        <div>ğŸ’¡ Hints Left: <span id="hud-hints">3</span></div>
        <div>â±ï¸ Time: <span id="hud-time">300</span>s</div>
        <div>ğŸ§© Puzzle <span id="hud-puzzle-index">1</span>/<span id="hud-puzzle-total">12</span></div>
        <div class="hud-right">
          <button id="btn-sound" class="btn small" aria-pressed="false" aria-label="Toggle music mode" disabled>ğŸµ Music: Off</button>
          <button id="btn-tutorial" class="btn small">ğŸ“˜ Tutorial</button>
          <button id="btn-dyslexia-game" class="btn small" aria-pressed="false" aria-label="Toggle dyslexia-friendly mode">Aa</button>
          <button id="btn-leaderboard-game" class="btn small">ğŸ†</button>
        </div>
      </header>

      <article class="puzzle-card">
        <h2 id="puzzle-title">Puzzle</h2>
        <p id="puzzle-story" class="story"></p>
        <div class="cipher-block">
          <label for="ciphertext" class="label">Ciphertext</label>
          <textarea id="ciphertext" readonly aria-readonly="true"></textarea>
        </div>

        <div id="prompt-area"></div>

        <div class="actions">
          <button id="btn-check" class="btn">Check</button>
          <button id="btn-hint" class="btn">Use Hint (âˆ’10)</button>
          <button id="btn-tools" class="btn">Tools</button>
        </div>

        <div id="feedback" class="feedback" role="status" aria-live="polite"></div>
      </article>

      <!-- Tools Modal -->
      <dialog id="tools-dialog" aria-label="Cryptography Tools">
        <h3>Cryptography Tools</h3>
        <div class="tools-grid">
          <section>
            <h4>Brute Force (Caesar)</h4>
            <label for="bf-shift">Shift (0â€“25)</label>
            <input type="number" id="bf-shift" min="0" max="25" value="0"/>
            <button id="bf-apply" class="btn small">Apply</button>
            <pre id="bf-output" class="mono"></pre>
            <button id="bf-all" class="btn small">Show All Shifts</button>
            <pre id="bf-all-output" class="mono small"></pre>
          </section>

          <section>
            <h4>Letter Frequency</h4>
            <button id="freq-calc" class="btn small">Calculate</button>
            <pre id="freq-output" class="mono small"></pre>
            <p class="hint-note">Tip: English often has E, T, A, O, I, N more frequently.</p>
          </section>

          <section>
            <h4>VigenÃ¨re Helper</h4>
            <label for="vig-key" class="label">Keyword</label>
            <input type="text" id="vig-key" placeholder="Try: LYRICS, TABBY, CHEESE, PASTRY, SPICE" />
            <div class="actions">
              <button id="vig-preview" class="btn small">Preview Decrypt</button>
              <button id="vig-clear" class="btn small">Clear</button>
            </div>
            <pre id="vig-output" class="mono small" aria-live="polite"></pre>
            <p class="hint-note">
              VigenÃ¨re repeats the keyword over the message and applies a Caesar shift per letter.
              Use the Tutorial for examples.
            </p>
          </section>
        </div>
        <button id="tools-close" class="btn">Close</button>
      </dialog>

      <!-- Universal Modal for all popups -->
      <!-- universal modal moved to document root for visibility across screens -->
    </section>

    <!-- Win / Summary Screen -->
    <section id="screen-win" class="screen" role="region" aria-labelledby="win-title">
      <h2 id="win-title">You Escaped! ğŸ—ï¸</h2>
      <p>Final Score: <strong id="final-score"></strong></p>
      <p>Total Time: <strong id="final-time"></strong>s</p>

      <div class="save-score">
        <label for="player-name" class="label">Save your score (name or initials)</label>
        <input id="player-name" type="text" maxlength="24" placeholder="e.g., BENJAMIN" />
        <button id="btn-save-score" class="btn primary">Save to Leaderboard</button>
      </div>

      <div class="post-win-actions">
        <button id="btn-view-lb" class="btn">View Leaderboard</button>
        <button id="btn-replay" class="btn primary">Play Again</button>
        <button id="btn-tutorial-win" class="btn">ğŸ“˜ Tutorial</button>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>Learn to love cryptography! â€¢ Built for learning</span>
  </footer>

  <!-- Universal modal placed at document root so it's never inside a hidden screen -->
  <div id="universal-modal" class="modal" style="display:none;">
    <div class="modal-content" id="modal-content"></div>
    <button id="modal-close" class="btn">Close</button>
  </div>

  <!-- script.js is included once at document end to avoid double-execution -->
  <script src="script.js?v=20251015153000"></script>
</body>
</html>
